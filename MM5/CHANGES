
You will find descriptions of the changes to the MM5 version 3
source code in this file. For the difference file between the
current release and the last release, please see 
Diff/diff.ddmmmyy. The 'current release' refers to the newest
source code, while the 'last release' refers to the source code
in the previous release. Each release will be a complete tar file
such as this. The bug fixes/changes in the diff.ddmmmyy
files will be the differences between successive releases.

The current release is 3.7.4 (release-3-7, December 23, 2004).
============================================================

Bug fixes and changes since V3.7:

October 16, 2006 (release-3-7-4)

- A fix to the min vegetation fraction. This change has only a 
  small impact on the snow albedo when using the Noah LSM
  Affected file:
  domain/io/rdinit.F

- Fix an out of bounds loop for the top vertical advection for w.
  Affect on results is minimal.
  Affected file:
  physics/advection/simple/vadv.F


November 21, 2005 (release-3-7-3)

- Improve Noah LSM's new emissivity treatment by accounting for 
  emissivity effect in its longwave input. Will give cooler temperatures
  over land at night.
  Affected file:
  physics/pbl_sfc/noahlsm/surfce.F
  
- Change LANDUSE.TBL to match the one use in WRF.
  This new LANDUSE.TBL reduced the albedos for some categories slightly,
  which will result in slightly warmer daytime temperatures.
  Affected file:
  Run/LANDUSE.TBL


- Change the SKINTEMP back to the older method (this is now similar to
  the method used in WRF). This may increase the diurnal surface temperature 
  range by up to 2 C.
  Affected file:
  physics/pbl_sfc/noahlsm/sflx.F

- Fix a MPI bug for running Noah LSM, with nested domains.
  Affected file:
  MPP/RSL/parallel_src/bcast_size.F

June 22, 2005

- Add the -DMPI2_SUPPORT flags to the SGI Altix with Intel 
  compilers flags
  Users that need this flag, also need to download a new MPP tar file
  Thanks to Gerardo Cisneros (SGI)
  Affected file:
  configure.user
  MPP/RSL/RSL/makefile.altix
  

May 12, 2005  (release-3-7-2)

- Bug fix:
  The 3.7.1 updates to the MRF scheme contained a bug weakening 
  the strength of the boundary layer mixing.
  Thanks to Greg Thompson of RAP/NCAR for the fix
  Affected file:
  physics/pbl_sfc/mrfpbl/mrfpbl.F

- Add -traditional to intel compiler flags
  Affected file:
  configure.user

April 29, 2005  (release-3-7-1)

- Fix to undefined parameters when running over very steep topography
  Thanks to Mike Rezny (Cray Australia) and Hee-Sik Kim (Cray Korea) 
  Affected file:
  physics/cumulus/kf2/kfpara2.F

- Changes to MRF routines
  1) Change the computation of RLAM to be a function of delta-z
  2) Instead of imposed parabolic mixing coeff profile in BL, use
     the max of that AND the value computed from local K-theory
     (the latter will increase mixing in cloud-topped BLs).
  3) Bug fix:  
     g/theta-v(k) used for local Ri at all levels, 
     rather than g/theta-v(kl) 
  Affected file:
  physics/pbl_sfc/mrfpbl/mrfpbl.F

- Improved snow albedo's in LANDUSE table
  Affected file:
  Run/LANDUSE.TBL

- Add byteswap option to Makefile, so this will be feed
  down to lower level Makefile. 
  This change only affect Linux users
  Affected file:
  Makefile

- Add compiler options for SGI Altix with Intel compilers and SGI MPI
  Thanks to Dr. Gerardo Cisneros  |SGI
  Affected file:
  configure.user

- Compiler flags for MAC computers (with xlf compilers) added
  Affected file:
  configure.user

- Change default compiler for MPI linux to f90, as this is
  needed for the diffusion scheme
  Affected file:
  configure.user

- Fix for compiling with OpenMp on Linux machines.
  Thanks to Yu-Jin Choi from Arizona State University
  Affected file:
  physics/advection/simple/hadv.F

- Remove default values for ISTLYR and ISMLYR. These values
  must now be specify via the namelist when running
  ISOIL=2 and =3
  Affected files:
  domain/initial/param.F
  include/landinp.F

- Increasing the soil heat capacity over urban areas, and
  using a higher roughness lenght for urban areas. This is 
  to better represent the turbulence generated by roughness 
  elements and drag due to buildings
  Affected files:
  Run/LANDUSE.TBL
  physics/pbl_sfc/noahlsm/sflx.F

- Change the updating of the z-diffusion scheme to be only
  calculated if IFBTER(INEST) is true
  Affected files:
  domain/nest/feedbk.F
  MPP/RSL/parallel_src/mp_feedbk.F

- Fix for IPTDIF and using restart
  Affected file:
  domain/initsav.F

============================================================

Bug fixes and changes in V3.7:

1. Bug fixes:

- When IMOIAV is not zero and snow melts (IFSNOW=2), do not reset soil moisture 
  to table value. Thanks to David Ovens from UW.

  Affected files:
  Run/mm5.F
  domain/boundary/lbdyin.F
  domain/initial/init.F
  domain/nest/initnest.F
  dynamics/nonhydro/solve.F

- Change default soil input layers from 10,200, to the more commonly 
  available layers of 10,40,100,200, and add ISTLYR and ISMLYR to lparam
  in the deck, which makes it easier for users to change the soil layers 
  that are used as input to the model.

  Affected file:
  Templates/lparam
  domain/initial/param.F

- Avoid negative PBL height in diagnostic when Eta PBL is used.

  Affected file:
  physics/pbl_sfc/myepbl/myepbl.F

- Correction to Noah LSM for seaice initialization.
  (in the code since version 3.6.1)

  physics/pbl_sfc/noahlsm/surfce.F

- Fix for allowing 2 nests on the same level when using 
  the Noah LSM model.

  Affected files:
  domain/nest/initnest.F

- Define Z0 when there is no snow in Noah LSM.
  (in the code since version 3.6.1)

  Affected file:
  physics/pbl_sfc/noahlsm/sflx.F

- Initialize variables to that FNDSOILW is now used correctly. 
  Thanks to Barry Lynn from HUJ, Israel.

  Affected files:
  domain/initial/init.F 
  domain/io/rdinit.F
  domain/nest/initnest.F

- Correct MPI feedback of XLAND. Only effect if running with IEXSI=2
  (in the code since version 3.6.2)

  Affected file:
  MPP/RSL/parallel_src/mp_feedbk.F

- Correct a dimension error for XLAND
  (in the code since version 3.6.2).

  Affected file:
  physics/cumulus/bm/cupara7.F

- Initialize seaice on nest from LOWBDY_DOMAIN1 if no LOWBDY_DOMAIN2 exist, 
  for iexsi >= 1 (in the code since version 3.6.2).

  Affected files:
  domain/nest/initnest.F
  MPP/RSL/mpp_initnest_30.incl

- Add feedback of SEAICE and TGSI            
  (in the code since version 3.6.2).

  Affected files:
  domain/boundary/lbdyin.F
  domain/initial/init.F
  domain/nest/feedbk.F
  MPP/RSL/parallel_src/mp_feedbk.F, define_comms.F
  MPP/RSL/parallel_src/bcast_size.F, merge_size.F

- Fix for running with multiple input files, with FDDA on
  and doing a restart. A new namelist variable IFRSFA is added
  for this purpose, and it is used together with CDATEST. 

  Affected files:
  Templates/oparam
  domain/initial/param.F
  include/param2.incl
  MPP/namelist.data

- Syntax correction to lookup table version of Reisner 1 scheme
  - to prevent compilation error. Also update two constants used
  in the routine so that it is consistent to the non-lookup table
  version of the code (in the code since version 3.6.1).

  Affected file:
  domain/initial/param.F
  physics/explicit/reisner1/lexmoisr.F
  physics/explicit/simple/lexmoiss.F

- Add check to prevent IFSNOW=2 and ISOIL=3 to be used together.
  Thanks to Tanya Otte of EPA.

  Affected files:
  domain/initial/param.F

- Correct an error for filling outer row and column for GS TKE
  (in the code since version 3.6.2).

  Affected file:
  domain/io/outtap.F

- Fix an "out of bound" problem for TKEA in MPI code
  (in the code since version 3.6.2).

  Affected file:
  MPP/RSL/parallel_src/mp_stotndt.F

- Fix to allow the output of TKE when IADVTKE is set to 0.

  Affected file:
  dynamics/nonhydro/solve.F

- Improvement in seasonal vegetation adjustment for ISOIL=3 option
  (in the code since version 3.6.2).

  Affected file:
  physics/pbl_sfc/pxpbl/vegeland.F

- Ensure that VEGFRAC is not updated every 24 hours for ISOIL=3 option
  (in the code since version 3.6.2).

  Affected file:
  dynamics/nonhydro/solve.F

- Correct the initialization of the SWDOWN field when 
  the CCM2 radiation is used. This only affected the 
  MPP version of the code.
  (in the code since version 3.6.1)

  Affected file:
  MPP/RSL/Makefile.RSL

- Prevent possible divide by zero in GS scheme.

  Affected file:
  physics/pbl_sfc/gspbl/gspbl.F

- Correct print statements so that each TBL file has separate error 
  information prints (in the code since version 3.6.2).

  Affected file:
  domain/initial/param.F

- Soil temp adjustment changed from 6k/km to 6.5k/km, to be consistent 
  with rest of programs, affect only if running with old REGRID input
  (in the code since version 3.6.2).

  Affected files:
  domain/io/rdinit.F

- Make the constant CP consistent throughout the code.

  Affected file:
  physics/cumulus/kf2/dtfrz2.F, tpmix2.F

- Fix for OpenMP 
  Thanks to Carlie Coats of BaronAMS.

  Affected files:
  dynamics/nonhydro/solve.F
  domain/nest/initnest.F

- Fix long line that creates compiler problems on Sun.

  Affected file:
  physics/explicit/reisner1/exmoisr.F

- Prevent compilation error on some machines.
  (in the code since version 3.6.1)

  Affected files:
  domain/initial/init.F
  domain/nest/initnest.F


2. Changes:

- Move the calls to cumulus schemes to below the calls to PBL schemes 
  so the Grell scheme can make use of the updated PBL tendency.
  Hence this change mainly has an effect on the Grell scheme.
  Other cumulus schemes are only slightly affected (roundoff differences).

  Affected file:
  dynamics/nonhydro/solve.F

- Update the Reisner2 scheme
  (See comments at top of affected files for more details).
  Thanks to Greg Thompson of NCAR/RAP.

  Affected files:
  physics/explicit/reisner2/exmoisg.F
  domain/initial/paramr.F

- Update of the Schultz scheme. The amount of cloud liquid at any given 
  time is diagnosed as some fraction of (qv+qc)/qvsat. Change the method 
  for computing saturation adjustment to MM5 one, replacing the iterative 
  method. Thanks to Paul Schultz of FSL.

  Affected files:
  physics/explicit/schultz/schultz.F, schultz_mic.F

- Change to convective velocity, PBL height and surface stress calculations
  in MRF PBL. The net effects are reduced convective velocity, reduced PBL
  height, and removed momentum dependency on convective velocity. 
  Thanks to Yubao Liu of NCAR/RAP.

  Affected file:
  physics/pbl_sfc/mrfpbl/mrfpbl.F

- Improve 2m temperature calculations for the Noah LSM scheme.

  Affected files:
  physics/pbl_sfc/mrfpbl/mrfpbl.F
  physics/pbl_sfc/myepbl/myepbl.F
  physics/pbl_sfc/noahlsm/surfce.F

- Improve the CCM2 shortwave radiation result by modifying cloud ice radius.
  The change reduces the effect of cloud on shortwave radiation.
  Thanks to Cliff Mass of UW.

  Affected file:
  physics/radiation/ccm2/radcsw.F

- Change the default maximum nest level from 3 to 5.

  Affected files:
  domain/drivers/Makefile, nstlev3.F
  domain/drivers/nstlev4.F, nstlev5.F (new)
  MPP/mpp_objects_all

- Add a new switch, ISFMTHD, in LPARAM to allow for a different way 
  to diagnose 2 m temperature/moisture and 10 m winds in stable regime. 
  The general impact in a stable regime would be cooler temperature
  and weaker winds. (Thanks to John Nielsen-Gammon of Texas A&M.)
  (in the code since version 3.6.1)

  Affected files:
  Templates/lparam
  domain/initial/param.F
  physics/pbl_sfc/hirpbl/hirpbl.F
  physics/pbl_sfc/mrfpbl/mrfpbl.F
  include/param2.incl
  MPP/namelist.data

- KF2 code is cleaned up to avoid potential computational problems 
  on Linux machines. Thanks to Jack Kain of NSSL.

  Affected file:
  physics/cumulus/kf2/kfpara2.F, lutab.F, tpmix2.F

- Add TGSI to MMOUT_DOMAINx
  (in the code since version 3.6.2)

  Affected file:
  domain/io/outtap.F

- Change message written out when nest do not have a LOWBDY
  file as input from "ERROR" to "ADVISORY"

  Affected file:
  domain/boundary/lbdyin.F

3. New in 3.7:

- Add Polar option (IPOLAR=1) to the MRF PBL scheme.

  Affected files:
  domain/initial/param.F
  dynamics/nonhydro/solve.F
  physics/pbl_sfc/mrfpbl/mrfpbl.F

- Add horizontal diffusion modifications to the code. This allows for diffusion to be 
  calculated truly horizontal. This option is turned on by setting ITPDIFF to 2.
  Thanks to Guenther Zaengl from the University of Muenchen.

  Affected files:
  Templates/lparam
  domain/initial/Makefile, init.F, param.F
  domain/nest/Makefile, feedbk.F
  dynamics/nonhydro/Makefile, solve.F
  include/param2.incl
  include/zdiffu.incl, zdiffu2.incl (new)
  physics/hzdiffu/simple/Makefile, coef_diffu.F
  physics/hzdiffu/simple/diffintp.F, diffmoi.F (new)
  physics/hzdiffu/simple/diffth.F, diffthd.F (new)
  MPP/mpp_objects_all, namelist.data
  MPP/RSL/parallel_src/mp_feedbk.F

- Add advection modifications to the code. This new code allow for the use
  of an instability limiter when calculating advection.
  Two new parameters are included for this option, ITADVM, which switches the
  new temperature advection code on, and IQADVM which is used for the new
  moisture advection code. This may have a benefit when using the new diffusion
  scheme described above and in high-resolution, complex terrain domain.
  Thanks to Guenther Zaengl from the University of Muenchen.

  Affected files:
  Templates/lparam
  domain/initial/param.F
  dynamics/nonhydro/Makefile, solve.F
  include/param2.incl
  physics/advection/simple/Makefile, hadv.F
  physics/advection/simple/vadv2.F (new)
  MPP/namelist.data

- Solar slope and topography shadowing effects are included with 
  two new switches, LEVSLP and OROSHAW. 
  LEVSLP indicates the nest level at which solar radiation start
  accounting for orography. (This will correspond to LEVIDN).
  This is only recommended for very high resolution model runs.
  To switch this off, set LEVSLP equals to a large number like 9.
  OROSHAW include the effect of orography shadowing. This only has
  an effect if LEVSLP is also set. OROSHAW is NOT included in 
  the MPP version of the code.
  Thanks to Guenther Zaengl from the University of Muenchen.

  Affected files:
  Templates/lparam
  domain/initial/param.F
  dynamics/nonhydro/Makefile, solve.F
  include/param2.incl, param3.incl
  physics/radiation/cloud/swrad.F
  MPP/namelist.data

- The Noah LSM now has urban effect, and considers emissivity in 
  computing surface temperature. The second change generally 
  increases the amplitude of the diurnal cycle. Note, one must
  use the modified LANDUSE.TBL as well.
  Thanks to Fei Chen and Mukul Tewari of NCAR/RAP.

  Affected files:
  Run/LANDUSE.TBL
  physics/pbl_sfc/mrfpbl/mrfpbl.F
  physics/pbl_sfc/myepbl/myepbl.F
  physics/pbl_sfc/noahlsm/sflx.F, surfce.F

- Optimized routines to ensure faster run times. The new routines 
  especially improve run times on IBM computers. In order to give
  users a choice, both the optimized and original code are available.
  To switch to the optimized code, "-DIBMopt" needs to be added to
  the compiler flags in configure.user. 
  Users must also use the "massv" library to compile. If this 
  library is not available, a second compiler flag "-DvsLIB"
  needs to be added to the compiler flags.
  During tests runs on the IBM, most of these changes reduced 
  run times by approximately 2%. 
  The optimization to the exmoisr routine reduced run times by 
  up to 20%. This routine can be switched on separately from 
  the other optimization routines, by setting MPHYSTBL=2 in 
  the configure.user file. If this option is used, users must either
  include the "massv" library or add the compiler flag "-DvsLIB".
  These routines were kindly supply by Zaphiris Christidis of
  IBM and Carlie Coats of BaronAMS.

  Affected files:
  configure.user
  Util/parseconfig.c
  domain/initial/param.F
  domain/util/dcpl3dwnd.F
  dynamics/nonhydro/solve.F, sound.F
  fdda/grid/blnudgd.F, bufslgd.F, nudgd.F, qsatgd.F
  physics/advection/simple/hadv.F, vadv.F
  physics/cumulus/grell/cup.F, cupara3.F
  physics/explicit/Makefile
  physics/explicit/reisner1/Makefile, zexmoisr.F
  physics/pbl_sfc/mrfpbl/tridi2.F
  physics/pbl_sfc/util/slab.F
  physics/radiation/cloud/lwrad.F
  MPP/FLICFILE, mpp_objects_all
  MPP/FLIC/FLIC/FLICFILE

- New Cray X1 compiler options. Thanks to Peter Johnsen from
  Cray.

  Affected files:
  Makefile
  configure.user
  Run/mm5.F
  dynamics/nonhydro/solve.F, sound.F
  fdda/grid/in4dgd.F
  include/addr0.incl
  memory/address/addall.F, addrx1c.F, addrx1n.F
  MPP/mhz.c, mpp_objects_all
  MPP/FLIC/FLIC/Makefile
  MPP/FLIC/Parser/Makefile
  MPP/FLIC/Scanner/Makefile
  MPP/RSL/Makefile.RSL
  MPP/RSL/RSL/compat.h, debug.c, domain_def.c
  MPP/RSL/RSL/exch_sten.c, makefile, makefile.x1
  MPP/RSL/RSL/rsl.h, /rsl_io.h, rsl_ioserve.c
  MPP/RSL/RSL/rsl_merge.c, rsl_remap_state.c
  MPP/RSL/parallel_src/x1_feedbk.F

- Add INTEL compiler flags.
  To accommodate the INTEL compiler, we also now close
  SAVE files and change ABORT to STOP statements.

  Affected file:
  configure.user
  domain/io/initsav.F
  domain/io/ouput.F
  domain/io/rdter.F

============================================================
Bug fixes and changes in V3.6:

1. Bug fixes:

- Correct an error with XTIME update for the nest if the nest
  starts later during a simulation. This is an error caused by
  our update in V3.5. No error in previous versions of MM5.
  (Thanks to Jennifer Cram for reporting the problem. 
  This bug fix has been in the tar file since Feb 25, 2002.)

  Affected files:
  domain/initial/param.F
  dynamics/nonhydro/solve.F

- Correct an error in defining CKH for the nest. Also CKH should
  be declared as REAL, not integer - only affect
  results if one sets CKH differently from 1 in mm5.deck.
  (These fixes have been in the tar file since Aug 27, 2002.)

  Affected files:
  include/param2.incl
  domain/initial/param.F
  domain/nest/initnest.F

- A correction to array indices to avoid possible memory overwrite.
  Only a problem if KF or FC scheme is not compiled.
  (Thanks to Bill Hall of NCAR.
  This bug fix has been in the tar file since Feb 25, 2002.)

  Affected file:
  domain/io/output.F

- A correction in estimating cloud base height in BM cumulus scheme.
  Small effect on results. (Thanks to Charlie Cohen of NASA.
  This bug fix has been in the tar file since Feb 25, 2002.)

  Affected file:
  physics/cumulus/bm/bmpara.F

- Consider smaller PBL time step too when estimating change in moisture 
  availability if Gayno-Seaman PBL scheme is used
  with bucket soil moisture option (IBLTYP = 6 and IMOIAV > 0).
  (Thanks to Guenther Zaengl of University of Munich.
  This bug fix has been in the tar file since Feb 25, 2002.)

  Affected file:
  physics/pbl_sfc/util/slab.F

- Minor correction to background vertical diffusion.
  (This bug fix has been in the tar file since Oct 31, 2002.)

  Affected files:
  physics/pbl_sfc/hirpbl/hirpbl.F
  physics/pbl_sfc/bulk/blkpbl.F
  physics/pbl_sfc/mrfpbl/mrfpbl.F

- Correction to Blackadar PBL for diagnosing T2/Q2/U10/V10 in
  regimes 1, 2 and 3.

  Affected files:
  physics/pbl_sfc/hirpbl/hirpbl.F

- PSIM and PSIH definitions for stable regime corrected in GSPBL.
  (Thanks to D Stauffer and G Bryan from Penn State University)
  (This bug fix has been in the tar file since Aug 27, 2002.)

  Affected files:
  physics/pbl_sfc/gspbl/gspbl.F

- A correction to output file names if using file split option.
  It will not write a new file if it is not a restart run.
  (This bug fix has been in the tar file since March, 2002.)

  Affected file:
  domain/io/outtap.F

- Allow for cloud field in the initial conditions while there is no cloud/rain
  in the boundary conditions (e.g. forecast cycling of cloud water).
  This would affect results only if cloud/rain field is present in the MMINPUT 
  file and not present in the BDYOUT file.
  (This bug fix has been in the tar file since Oct 31, 2002.)

  Affected files:
  Run/mm5.F
  domain/boundary/bdyin.F 
  domain/initial/init.F

- Add a fix to correct the major problems associated with running 
  the Reisner1 scheme on a vector machine
  This only effect runs done on vector machines. However, please note
  that we are still working on some problem related to vector option.
  (This bug fix has been in the tar file since Aug 27, 2002.)
  
  Affected files:
  physics/explicit/reisner1/exmoisr.F
  MPP/RSL/call_vector_exmoisr.incl, vec_exmoisr_80.incl, vector_solve_temps.incl

2. Changes and improvements:

- The Reisner graupel scheme has had substantial changes since
  3.5. These include bug fixes for number conc units, and use
  of RON2, change of snow to graupel conversion, Sc number used
  in PREI, PRE and PMLTEV. More can be found in documentation at
  beginning of exmoisg.F file. There is also undef'd code that
  would allow for calling this scheme less frequently for 
  efficiency in solve and exmoisg (not used by default).
  (Thanks to Greg Thompson of RAP/NCAR, Bill Hall of MMM/NCAR,
   and George Bryan of PSU.)

  Affected files:
  domain/initial/paramr.F
  dynamics/nonhydro/solve.F 
  include/jrg.incl
  physics/explicit/reisner2/exmoisg.F

- Add new updates to PXPBL scheme from Jon Pleim

  Affected files:
  domain/io/outtap.F
  include/comicl.incl
  physics/pbl_sfc/pxpbl/acm.F, pxpbl.F sfcmm4.F, surfpx.F, vdiff.F

- Fix to MRF PBL to make the soil temperatures more robust in some
  rare conditions.

  Affected files:
  physics/pbl_sfc/mrfpbl/mrfpbl.F

- Allow feedback of TKE from the nest for the Gayno-Seaman PBL.

  Affected file:
  domain/nest/feedbk.F

- Add a fix to correct rare blow-ups in the old KF scheme. Only affect
  running the model using vector option.

  Affected files:
  physics/cumulus/kf/kfpara.F

- Account for the melting of snow when IFSNOW=2. This completes
  the simple snow model modification added to MM5 in V3.5.

  Affected files:
  physics/pbl_sfc/util/slab.F

- Winds in time series output are now rotated to earth winds.

  Affected file:
  domain/io/outts.F

- Add a test, so that snow cover is only read and used from the LOWBDY file
  if IFSNOW=2.
  Small values of SNOWC are set to zero after they are read in.
  Initialize SNOWNCT array to zero each timestep to avoid poor boundary
  values of 1.0 in parallel model.
  (Thanks to Jennifer Cram of ATMET).

  Affected files:
  domain/boundary/lbdyin.F
  domain/io/rdinit.F
  dynamics/nonhydro/solve.F

- KLPBL=1 to allow MRF PBL to work when greater than half the layers
  are in the PBL (Thanks to S.-Y. Hong of University of Yonsei, Korea).
  Only affect results in above case.

  Affected files:
  physics/pbl_sfc/mrfpbl/mrfpbl.F

- Add a stop if ISOIL=2 and IFSNOW=2, these two options cannot
  be used together. No effect on results.

  Affected files:
  domain/initial/param.F

- Add a stop if options IOVERW=2 and IMOIAV = 2 are used. This is
  because IMOIAV = 2 requires soil moisture input, and if IOVERW = 2
  is used, soil moisture will not be interpolated correctly along
  land-water boundaries.

  Affected file:
  domain/initial/param.F

- Change I=2 to I=IBGN in diffu.F (Thanks to McHenry of MCNC).
  No effect on results.

  Affected files:
  physics/hzdiffu/simple/diffu.F

- Minor memory improvement. This change does not affect results.
  (Thanks to Xingang Fan of University of Alaska Fairbanks)

  Affected files:
  include/fddagd.incl 

- Change in batch IBM job deck. Remove rcp from IBM batch deck run on NCAR's IBM.

  Affected file:
  Templates/mm5.deck.ibm-mpp

3. New in 3.6:

- Replace OSU LSM with unified LSM (or NOAH LSM) (ISOIL=2 replaced). 
  This unifies code between AFWA AGRMET, NCEP Eta/LDAS, NCAR MM5, and 
  future WRF.
  New features include frozen-soil physics, snow height prediction,
  and ability to use read-in albedo data, among others.

  Affected files:
  domain/initial/Makefile
  domain/initial/init.F
  domain/initial/param.F
  domain/io/Makefile
  domain/io/outtap.F
  domain/io/rdinit.F
  domain/nest/Makefile
  domain/nest/feedbk.F
  domain/nest/initnest.F
  domain/nest/nestlsm.F
  dynamics/nonhydro/solve.F
  include/parame
  include/soilp.incl
  include/soilpn.incl
  memory/address/addall.F
  memory/address/addrx1c.F
  memory/address/addrx1n.F
  physics/pbl_sfc/mrfpbl/mrfpbl.F
  physics/pbl_sfc/myepbl/myepbl.F
  physics/pbl_sfc/util/Makefile
  physics/pbl_sfc/util/setvegfr.F
  MPP/mpp_objects_all
  MPP/namelist.data
  MPP/RSL/mpp_nestlsm_00.incl
  MPP/RSL/mpp_nestlsm_10.incl
  MPP/RSL/parallel_src/mp_feedbk.F

  New files:
  include/paramgen_LSM.incl
  include/paramsoil_STAS.incl
  include/paramveg_USGS.incl
  Run/GENPARM.TBL
  Run/SOILPARM.TBL
  Run/VEGPARM.TBL
  physics/pbl_sfc/noahlsm/Makefile
  physics/pbl_sfc/noahlsm/sflx.F
  physics/pbl_sfc/noahlsm/surfce.F

- Add polar physics modification from Ohio State U. These will allow for effects
  of sea-ice fraction, fluxes within sea-ice and snow/ice in slab, surface 
  fluxes over ice in the Eta PBL, Meyers ice nuclei conc in the simple
  and Reisner1 microphysics schemes, and modified permanent ice
  properties in LANDUSE.TBL. It is activated by IPOLAR=1 in
  configure.user. Sea-ice is diagnosed from SST (namelist variable IEXSI=1), 
  or fraction is read in (IEXSI=2) from LOWBDY file.
 
  Affected files:
  configure.user
  Run/LANDUSE.TBL
  Run/Makefile
  Run/mm5.F
  Templates/lparam
  Util/parseconfig.c
  domain/boundary/lbdyin.F
  domain/initial/init.F
  domain/initial/param.F
  domain/io/outtap.F
  domain/nest/feedbk.F
  domain/nest/initnest.F
  dynamics/nonhydro/solve.F
  include/Makefile
  include/param2.incl
  include/parame
  include/point2d.incl
  include/point2dn.incl
  memory/address/addall.F
  physics/explicit/reisner1/exmoisr.F
  physics/explicit/reisner1/lexmoisr.F
  physics/explicit/simple/exmoiss.F
  physics/explicit/simple/lexmoiss.F
  physics/pbl_sfc/myepbl/Makefile
  physics/pbl_sfc/myepbl/myepbl.F
  physics/pbl_sfc/myepbl/sfcdif.F
  physics/pbl_sfc/util/slab.F
  MPP/namelist.data
  MPP/RSL/mpp_lbdyin_10.incl
  MPP/RSL/parallel_src/mp_feedbk.F

4. MPP updates:

- Change to allow the creation of restrts directory in a MPI run if this 
  directory does not exist when the run starts. (Thanks to the suggestion
  by Bart Brashers of MFG Inc.) This change affects MPI run only.

  Affected files:
  configure.user 
  domain/io/output.F

- A correction to restart time calculation in MPI MM5 so that it
  is consistent with XTIME and hence MPI restart will be done correctly. 
  This change makes MPI code the same as the non-MPI code. 
  This affects MPI runs only.

  Affected files:
  MPP/RSL/mpp_output_10.incl

- Correct short-time step calculation when running MPI MM5 with the 
  MPI_IO_NODE=1 option. This change only affects when MPI_IO_NODE is used.
  (Thanks to Al Bourgeois from RAP/NCAR)

  Affected files:
  dynamics/nonhydro/sound.F 

- Correct the way record are created then the MPI_IO_NODE=1 option is used.

  Affected files:
  domain/io/write_fieldrec.F 

- Add MPP directives to allow for outputting number concentration in new unit
  in Reisner II scheme. 

  Affected files:
  domain/io/outtap.F, rho_mlt.F

- A update in MPP compile option for Linux machines.

  Affected file:
  configure.user

- Fortran and c compiler options will be passed down to RSL
  for Linux.

  Affected file:
  Makefile

============================================================

Please see Diff/diff.05DEC01 for actual differences.

1. Bug fixes:

- Correct a do loop indexing problem in MPP section of lbdyin.

  Affected file:
  domain/boundary/lbdyin.F

- Correct a problem with overwriting existing MMOUT file when
  using BUFFRQ at a unintended restart.

  Affected file:
  domain/io/outtap.F

- Correct a problem with landuse value not being updated when
  using IOVERW = 2 and OSU land-surface model.

  Affected files:
  domain/io/rdter.F
  domain/nest/initnest.F

- Correct two minor problems with FDDA checks: 
  1. I4DITOT is not yet defined in line PARAM.1550
  2. Should use runtime value for I4DTOT to do the check in line PARAM.1647

  Affected files:
  domain/initial/param.F

- Correct an OpenMP bug when coarse domain boundary values are updated.
  This may cause unrepeated results when OpenMP is used.
  (Thanks to Winston Hao of New York and Wesley Jones of SGI.)

  Affected file:
  domain/utildcpl3dwnd.F

- Correct a problem with model time (XTIME) drift problem when small
  time step is used and integration time is long. 
  (Thanks to Dave Stauffer of PSU and John Nielsen of TAMU for reporting.)

  Affected file:
  dynamics/nonhydro/solve.F

- Correct a bug when dynamic initialization option is used (IDYNIN=1,
  and DTRAMP > 0).

  Affected file:
  fdda/grid/in4dgd.F
  (Thanks to Dave Stauffer of PSU for reporting the problem.)

- Correct equivalent potential temperature calculation in Kuo scheme.
  (Thanks to Charlie Cohen of NASA/Mashall)

  Affected file:
  physics/cumulus/kuo/cupara2.F

- Move DATA statement below array declaration. This prevents an
  error in compilation on some Linux machines. No effect on results.
  (Change in MM5.TAR file since 5/17/01)

  Affected file:
  physics/cumulus/grell/cup.F

- Correction to PX LSM if FRAD > 0. (Change in MM5.TAR file since 11/15/00)

  Affected file:
  physics/pbl_sfc/pxpbl/pxpbl.F

- Correct the diagnostic calculation of outgoing short- and long-wave
  radiation when CCM2 radiation option is used.
  (Thanks to Edward Vizy of Cornell University)

  Affected file:
  dynamics/nonhydro/solve.F

- Change dimensions in CCM2 routines to allow MPP compilation on PCs.

  Affected files:
  physics/radiation/ccm2/wheneq.F, whenfgt.F


2. Changes and improvements:

- All decks are updated to use ./mm5.exe instead of mm5.exe.

  Affected files:
  Templates/mm5.deck.*

- Allow split MMOUT files to have suffix greater than 99.

  Affected file:
  domain/io/outtap.F

- Background diffusion is only a function of grid distance, not time step 
  any more. This change will not affect results if 3xDX is used as the time 
  step. If one uses either nxDX where n is greater than 3 or less than 3,
  then the result will change. A new namelist variable CKH under namelist
  section PPARAM may be used to obtain the same background diffusion as
  one uses before this change (default value of CKH=1).
  (Change based on a study by Xu et al. 2001, MWR)

  Affected file:
  domain/initial/param.F

  old formula:   XKHZ=3.E-3*DXSQ/DT 
  new formula:   XKHZ=CKH*DX

- Remove surface FDDA check for nest since it has been done in param.
  Not affecting results.

  Affected files:
  domain/nest/initnest.F

- Microphysics scheme Reisner 2 (IMPHYS=7) is updated with changes from 
  Greg Thompson of NCAR/RAP. The detailed change is documented near 
  the top of the subroutine exmoisg.F.

  Affected files:
  include/jrg.incl
  domain/initial/paramr.F
  physics/explicit/reisner2/exmoisg.F (replaced)

- Microphysics scheme Goddard is updated with changes from Scot Braun
  of NASA/Goddard. The detailed change is documented near 
  the top of the subroutines godmic.F and satice.F

  Affected files:
  physics/explicit/gsfc/godmic.F
  physics/explicit/gsfc/satice.F (replaced)
  physics/explicit/shared/consat.F

- Pleim-Xiu LSM model has been updated with changes from Jon Pleim.
  This scheme should work with OpenMP now, but no MPP version yet.

  Affected files:
  include/comicl.incl (replaced)
  physics/pbl_sfc/pxpbl/eddymm4.F,radsfc.F,surfpx.F
  physics/pbl_sfc/pxpbl/pxpbl.F,acm.F,sfcmm4.F,vegeland.F (replaced)
  dynamics/nonhydro/solve.F 

- Change stability function calculation in Gayno-Seaman scheme so
  that change in stability regime 1 and 2 becomes continous.
  (Thanks to G. Zaengl of University of Munich, Germany.)

  Affected file:
  physics/pbl_sfc/gspbl/gspbl.F

- Moist vertical diffusion (IMVDIF=1) in MRF and Blackadar PBL
  is modified to reduce light precip over ocean.

  Affected files:
  physics/pbl_sfc/hirpbl/hirpbl.F
  physics/pbl_sfc/mrfpbl/mrfpbl.F

- Change some constants used in OSU LSM.

  Affected file:
  physics/pbl_sfc/osusfc/hrt.F, hrtice.F, prmsoi.F

- Print-out of RAINK in OSU LSM is now rain in one timestep - 
  not accumulated. Prints only available if set NOOUT = 0 in surfce.F.

  Affected file:
  physics/pbl_sfc/osusfc/surfce.F


3. New in 3.5:

- New Kain-Fritsch scheme (ICUPA=8) is added. The new scheme includes
  a shallow convection parameterization among other changes.

  Affected files:
  configure.user
  Util/parseconfig.c
  include/parame, parkfcu2.incl, addrcu.incl, addrcun.incl
  domain/initial/param.F, init.F
  domain/io/output.F, outtap.F
  memory/address/addall.F, addrx1c.F, addrx1n.F
  physics/cumulus/Makefile
  physics/cumulus/kf2/cupara8.F, kfdrive.F, kfpara2.F, dtfrz2.F,
                      lutab.F, tp_cape.F, tpmix2.F, tpmix2dd.F (all new)

  Also shared files between old and new KF schemes were moved from
  physics/cumulus/kf directory to physics/cumulus/shared directory.
  These files are:  condload.F, envirtht.F, prof5.F

- Couple OSU LSM (ISOIL=2) with Eta PBL (IBLTYP=4). Output 2 m
  temperature, mixing ratio, and 10 wind. Also FDDA option is added
  with Eta PBL.

  Affected files:
  domain/initial/param.F
  domain/io/outtap.F, outts.F
  physics/pbl_sfc/myepbl/myepbl.F, sfcdif.F
  physics/pbl_sfc/osusfc/surfce.F

- 2 m temperature, mixing ratio, and 10 winds are output from Blackadar
  PBL option (IBLTYP=2).

  Affected files:
  domain/initial/param.F
  domain/io/outtap.F, outts.F
  physics/pbl_sfc/hirpbl/hirpbl.F

- Two options are added to compute thermal roughness length (Z_0t) for 
  Blackadar and MRF PBL schemes. This is controlled by a new namelist 
  variable IZ0TOPT under namelist section LPARAM.

  IZ0TOPT = 0: old method or Carlson-Boland formula.
          = 1: Garratt formula
          = 2: Zilitinkevich formula

  In contrast to the old method, the new options use same thermal roughness
  length for temperature and moisture.

  Affected files:
  include/param2.incl
  Templates/lparam
  domain/initial/param.F
  domain/io/outtap.F
  physics/pbl_sfc/hirpbl/hirpbl.F
  physics/pbl_sfc/mrfpbl/mrfpbl.F

- A simple snow model is added. This model requires water equivalent of snow
  depth (or WEASD) in the input, estimates snow depth change during a 
  model simulation, and output the field SNODPTH. The option is controlled 
  by IFSNOW = 2 in the namelist.

  Affected files:
  domain/initial/param.F, init.F
  domain/io/outtap.F, rdinit
  domain/nest/initnest.F, feedbk.F
  domain/boundary/lbdyin.F
  dynamics/nonhydro/solve.F
  physics/explicit/simple/exmoiss.F, lexmoiss.F
  physics/explicit/reisner1/Makefile, exmoisr.F, lexmoisr.F
  physics/explicit/reisner2/exmoisg.F

- Allow snow cover (SNOWC) data to be updated during a simulation if 
  time-varying SNOWC field is available in LOWBDY file. This is similar
  to SST update option available in V3.4.

  Affected files:
  Run/mm5.F
  domain/boundary/lbdyin.F
  domain/initial/init.F
  domain/nest/initnest.F

- Allow vegetation fraction data to be updated every 24 hours. Vegetation
  fraction data are only used in OSU land-surface model. Prior to V3.5,
  monthly vegetation fraction data were interpolated to the initial time,
  and kept constant during a simulation. In this release, vegetation
  fraction is updated every 24 hours by reinterpolating the data to the
  new date. This is done automatically.

  Affected files:
  include/parame, soilp.incl, soilpn.incl, addall.incl, addrx1c.incl, addrx1n.incl
  domain/nest/initnest.F 
  domain/io/rdinit.F, rdter.F
  dynamics/nonhydro/solve.F
  physics/pbl_sfc/util/Makefile, setvegfr.F (new file)

- Allow model-predicted cloud information to be used directly in CCM2
  radiation scheme instead of relative humidity. This is controlled by
  namelist variable ICLOUD = 1 - this is the default option in V3.5. 
  If a user wants to use RH instead of predicted cloud in CCM2, 
  set ICLOUD = 2.
  (Thanks to John Cassano (now at CU) and Byrd Polar Research Center)

  Affected files:
  domain/initial/param.F
  domain/io/outtap.F
  domain/nest/initnest.F
  physics/radiation/ccm2/colmod.F, cldems.F, getdat.F, radcsw.F, radctl.F, radded.F
  physics/radiation/sfc/sfcrad.F
  physics/pbl_sfc/pxpbl/radsfc.F


For complete new features since Version 3.1 release, please visit MM5 Web page:
http://www.mmm.ucar.edu/mm5/mm5v3/whatisnewv3-now.html


4. MPP updates:

- README.MPP in MM5 directory is updated to reflect current status.

  Affected file:
  README.MPP

- A batch deck for running MPP jobs on NCAR's IBM (blackforest) is
  available. One can get the deck from ~mesouser/MM5V3 directory 
  on blackforest, or make one by setting RUNTIME_SYSTEM = sp2
  in configure.user file.

- The new KF scheme is ported for MPP.

- The coupling of Eta PBL and OSU LSM is tested in MPP.

- The simple snow model is tested for MPP.

- Use 'Implicit None'.

  Affected file:
  fdda/obs/errob.F

- Bug fix for IOVERW=1 option on a Linux.

- Bug fix for Burk-Thompson PBL in MPP version.

  Affected file:
  physics/pbl_sfc/btpbl/outpb.F 

- Bug fix for observational nudging in MPP version.

  Affected file:
  include/fddaob.incl

============================================================

Bug fixes and changes in V3.4:

Please see Diff/diff.07NOV00 for actual differences.

1. Bug fixes:

- Corrections in land use properties for summer season tundra in
  old 13-category data, and summer season ground cover in 16-category
  SiB data so that snow factor may be considered. (Thanks to 
  Jing Zhang of Geophysical Institute of UAF.)

  Affected file:
  Run/LANDUSE.TBL

- Adapt mm5.deck on Linux machines to run FDDA option.

  Affected file:
  Templates/mm5.deck.linuxPGF77

- Another correction for domain suffixes in output files.

  Affected file:
  domain/io/outtap.F

- Correct a problem when IFSKIP and grid FDDA are used together.
  (This change is in the tar file since 5/30/00.)

  Affected file:
  domain/io/rdinit.F

- Correct two typos. It affects graupel schemes and nest runs. On
  some machines this may cause the model to abort.

  Affected file:
  domain/nest/stotndt.F

- Correct two array dimension errors in shallow convective scheme
  (thanks to Ruby Leung of PNL).
  (This change is in the tar file since 5/30/00.)

  Affected file:
  physics/cumulus/shallow/shallcu.F

  Another fix is put in to correct entrainment in this scheme.

  Affected file:
  physics/cumulus/shallow/shallow.F, entrs.F
  physics/cumulus/shared/precip.F

- Correct a bug in Reisner I scheme. Minor effect.
  (Thanks to Chao-Tzuen Cheng from SUNY Albany.)

  Affected file:
  physics/explicit/reisner1/exmoisr.F

- Correct a bug in Burk-Thompson scheme. The bug was introduced
  in the 3-3 release due to change of definition of longwave
  radiation when CCM2 radiation scheme was used. (See Changes
  listed below.) (Thanks to Xin-Zhong Liang of University of Illinois.)
  (This change is in the tar file since 3/15/00.)

  Affected file:
  physics/pbl_sfc/btpbl/hoskeep.F

  Also, snow effect is considered in this scheme now.

  physics/pbl_sfc/btpbl/hoskeep.F, navypb.F

- Correct a small error in Gayno-Seaman PBL scheme's tstar calculation.
  (This change is in the tar file since 5/17/00.)

  Affected file:
  physics/pbl_sfc/gspbl/gspbl.F

- Initialize variable MITER0 used in Blackadar scheme (Thanks to
  Xinzhong Liang of University of Illinois).
  (This change is in the tar file since 5/30/00.)

  Affected files:
  include/varia.incl
  physics/pbl_sfc/hirpbl/hirpbl.F

- Make soil time step more conservative in ISOIL=1 option.
  A new namelist variable, SOILFAC, can be added in namelist section
  PPARAM to control how conservative one wants the soil time step to be.
  The default is 1.0, and a number greater than 1.0 will make the
  soil time step more conservative.

  Affected file:
  include/param2.incl
  domain/initial/param.F
  physics/pbl_sfc/util/slab.F

- Correct a slight error in surface pressure and theta calculation
  in LSM scheme. Could lead to ground temperatures a few tenths of
  a degree warmer.
  (This change is in the tar file since 5/17/00.)

  Affected file:
  physics/pbl_sfc/osusfc/surfce.F

- Declare a variable, KDT, real. Small effect on sfc runoff.

  Affected file:
  physics/pbl_sfc/osusfc/srt.F

 
  MPP bug fixes:

- Add MPP directives for field SNOWC initialization if LSM option
  is selected. Even though SNOWC field is not directly used by
  LSM, but its presence affects definitions of other land properties
  if IFSNOW is set to 1. Affect MPP/LSM runs - giving bad results.
  If you obtain the new tar file, please remember to obtain the new
  MPP.TAR.gz file.

  Affected file:
  domain/io/rdinit.F


2. Changes and improvements:

- Minor changes in compilation flags for IBM and Alpha, and new ones
  for ALPHA Linux with MPI, NEC SX-4 (still under development), and Sun MPI.

  Affected file:
  configure.user

- Removed unused indices in parallel directives.

  Affected file:
  domain/boundary/nudge.F

- Code clean up: move thermal capacity CAPG calculation from sfcrad.F to
  initialization routines.

  Affected files:
  domain/initial/init.F
  domain/nest/initnest.F
  physics/radiation/sfc/sfcrad.F

- Use sidereal day instead of solar day.

  Affected file:
  domain/initial/param.F

- Add lookup-table option for some explicit schemes in big header if
  it is selected (MPHYSTBL = 1).

  Affected file:
  domain/initial/param.F

- ANSI compliance for some print statements.

  Affected files:
  domain/initial/param.F, init.F
  domain/nest/initnest.F

- Change output time checks from real (XTIME) to integer (KTAU).
  This prevents model output times drifting when integration time is long.

  Affected files:
  domain/initial/init.F
  domain/io/output.F, initsav.F, shutdo.F
  domain/nest/chknst.F

- The model now allows for time-step change at a restart. 
  However there are a few constants
  in the model (e.g., GNUDGE, XKHMAX, and XKHZ) that also depend on
  time step, which are not changed. Note also that changing time step is 
  not a recommended practice. It only provides a convenient way if it
  is needed to continue the run and/or debug the program.

  Affected file:
  domain/io/initsav.F

- Related to the time-step change at a restart, the print of time (in sec)
  and domain number, which appear in mm5.print.out file, is now done in solve, 
  rather than sound. Also note that because of this change, a nest that
  starts at later time will have the same time printed as the other domains.

  Affected files:
  dynamics/nonhydro/solve.F, sound.F

- Cross-point arrays on output are filled with values in the row and column
  next to them. This will make data handling in post-processing software 
  a bit easier. However, users must be aware that dot- and cross-point
  variables are not located at the same grid point (see MM5 document for details).

  Affected file:
  domain/io/outtap.F
  domain/util/Makefile, fillcrs.F (new)

- Prevent vegetation fraction from becoming too small, and
  use WEASD (water-equivalent snow depth) to replace snow cover field if
  it is present.

  Affected file:
  domain/io/rdinit.F

- In V3.4, deep soil temp from output of TERRAIN is adjusted to the model
  terrain in REGRID/regridder; it is no longer done in MM5. But the code
  is backward compatible if you use pre-V3.4 MMINPUT files.

  Affected file:
  domain/io/rdinit.F

- Fortran units for TERRAIN input are closed after use.

  Affected file:
  domain/io/rdter.F

- Allow sea ice interpolation.
  Adjust substrate temperature in nests when terrain changes.

  Affected file:
  domain/nest/initnest.F

- Make coarse and nest land-water mask field (XLAND) consistent at feedback stage.

  Affected file:
  domain/nest/feedbk.F

- Interpolate coarse domain soil T and moisture field to nest. This makes
  the nest output look nicer along boundaries.

  Affected file:
  domain/nest/stotndi.F

- Make a number of subroutines 'implicit none'.

  Affected files:
  domain/util/equate.F
  physics/cumulus/grell/cup.F, cupara3.F, maximi.F, minimi.F
  physics/cumulus/kf/condload.F, envirtht.F, kfpara.F, tpmix.F
  physics/explicit/reisner1/exmoisr.F
  physics/pbl_sfc/mrfpbl/mrfpbl.F, tridi2.F
  physics/pbl_sfc/util/slab.F
  physics/radiation/rrtm/rrtm_k_g.F 

- Remove unused variables.

  Affected file:
  include/varia.incl

- Remove a number of 'not-so-useful' prints from sound routine.

  Affected file:
  dynamics/nonhydro/sound.F

- If a user has very large vertical dimension in MM5 grid, and 
  does not compile/use Kuo scheme, one may reduce the memory requirement
  by specifying -DNOKUO in FCFLAGS of the configure.user file so
  that two big arrays (TWGHT and VQFLX) used by Kuo scheme will not
  be dimensioned.

  Affected file:
  include/pmoist.incl

- Make local array scalar.

  Affected file:
  physics/advection/simple/vadv.F

- Add IVQADV option for Anthes-Kuo scheme (ICUPA=2).

  Affected file:
  physics/cumulus/kuo/cupara2.F

- slab.F will be compiled all the time.

  Affected file:
  physics/pbl_sfc/Makefile

- Reduce ground temperature and ground potential temperature conversoin
  calculations to improve accuracy.
  (Thanks to Guenther Zaengl of University of Munich, Germany.)

  Affected files:
  physics/pbl_sfc/bulk/blkpbl.F
  physics/pbl_sfc/gspbl/gspbl.F
  physics/pbl_sfc/mrfpbl/mrfpbl.F
  physics/pbl_sfc/myepbl/myepbl.F
  physics/pbl_sfc/util/slab.F
  physics/pbl_sfc/osusfc/surfce.F

- Allow Gayno-Seaman scheme to run with mixed phase explicit scheme
  (IMPHYS=5).

  Affected file:
  physics/pbl_sfc/gspbl/gspbl.F

- Change all data statements in RRTM to a binary file. This significantly
  reduces compile time on some platforms (noteably, Cray).

  Affected files:
  physics/radiation/rrtm/rrtm_init.F, rrtm_k_g.F
  Run/RRTM_DATA (new)

  Minor clean up:
  physics/radiation/rrtm/rrtm_setcoef.F, rrtm_taumol.F


3. New in V3.4:

- Additional outputs. If MRF PBL scheme is used, then additional 2D output
  of 10 m u and v component of winds, 2 m temperature and mixing ratio
  are now in the standard output (field names T2, Q2, U10, and V10). 

  Affected files:
  physics/pbl_sfc/mrfpbl/mrfpbl.F
  domain/io/outtap.F
  include/point2d.incl, point2dn.incl

  If you use atmospheric radiation options, 2, 3 and 4, additional two 2D
  fields are output: out-going long- and short-wave radiation (field names
  LWOUT and SWOUT).

  Affected routines:
  domain/io/outtap.F
  physics/radiation/rrtm/rrtm.F
  physics/radiation/ccm2/colmod.F, radclw.F, radcsw.F, radctl.F, radout.F
  physics/radiation/cloud/lwrad.F, swrad.F
  dynamics/nonhydro/solve.F
  include/parame, point2d.incl, point2dn.incl

- LANDUSE.TBL values are only output if ISFPAR = 1. The constant landuse
  properties are output in big header.

  Affected file:
  domain/io/outtap.F

- Add the simple soil moisture bucket scheme from MM5 real-time model run at 
  NCAR/MMM. It is added to slab.F and can be used with IBLTYP=2,4,5, and 6. 
  This scheme may be activated using namelist variable IMOIAV, which takes
  3 values: 0: bucket model not used; 1: bucket model used, but initialize
  it with climatological moisture availability data in LANDUSE.TBL; 
  3: bucket model used, and initialize it with soil moisture data from those
  datasets that are used to initialize OSU LSM (e.g., NNRP, AWIP, and AVN data).

  Affected file:
  domain/initial/param.F, init.F
  domain/nest/initnest.F, feedbk.F
  domain/io/rdinit.F, outtap.F
  dynamics/nonhydro/solve.F
  Run/BUCKET.TBL (new)
  physics/pbl_sfc/util/slab.F
  physics/pbl_sfc/bulk/blkpbl.F
  physics/pbl_sfc/hirpbl/hirpbl.F
  physics/pbl_sfc/mrfpbl/mrfpbl.F
  physics/pbl_sfc/myepbl/myepbl.F
  physics/pbl_sfc/gspbl/gspbl.F
  physics/radiation/sfc/sfcrad.F
  Templates/lparam

- Add capability to output time-series of 14 2-D variables.

  Affected files:
  domain/initial/Makefile, init.F, initts.F (new)
  domain/io/Makefile, initsav.F, outts.F (new)
  domain/nest/initnest.F
  dynamics/nonhydro/solve.F
  include/parame, param2.incl
  Templates/oparam

- Allow SST/SEAICE/SNOW COVER to be updated during (long) model simulations.
  This requires a user to use the V3.4 REGRID and INTERPF to
  generate appropriate LOWBDY files. 
  Once a user has these input in the LOWBDY files, one may control whether to 
  allow these fields to vary in time with a namelist option ISSTVAR (=1 means to
  vary, =0 means do not vary).

  The model also allows nests to input LOWBDY files if they are present in 
  the Run directory. This is recommended if a user has high-resolution lower 
  boundary conditions such as sea-surface temp, sea ice, and snow cover data.

  Affected files:
  Run/mm5.F
  include/param2.incl
  domain/boundary/Makefile, lbdyin.F (new)
  domain/initial/init.F, param.F
  domain/nest/initnest.F
  Templates/lparam
  
- Nest initialization with LSM and IOVERW=2 option. This allows
  nest initialized at either the beginning or later model times to
  have the correct land-water masked fields without getting them
  from MMINPUT files.

  Affected routines:
  domain/nest/Makefile, initnest.F, 
  domain/nest/nestlsm.F (new)
  domain/io/rdter.F

- Addition of a new LSM scheme, Pleim-Xiu LSM (ISOIL=3 and IBLTYP=7). 
  This scheme requires extra output from program TERRAIN (IEXTRA switch).

  Affected routines:
  Util/parseconfig.c
  include/parame, soilp.incl, soilpn.incl
  domain/initial/init.F, param.F
  domain/io/outtap.F, rdinit.F
  domain/nest/initnest.F
  dynamics/nonhydro/solve.F
  memory/address/addall.F addrx1c.F addrx1n.F
  physics/pbl_sfc/Makefile
  physics/pbl_sfc/pxpbl/Makefile acm.F eddymm4.F pxpbl.F qflux.F radsfc.F sfcmm4.F
                        smass.F soilav.F surface.F vdiff.F vegeland.F (all new)

For complete new features since Version 3.1 release, please visit MM5 Web page:
http://www.mmm.ucar.edu/mm5/mm5v3/whatisnewv3-now.html


4. MPP updates:

- Port to Alpha Linux clusters, and Sun MPI

- Port to NEC SX/5 (in progress)

- Vector optimization option for CUPARA3, EXMOISR, and MRFPBL for 
  Fujitsu VPP5000

- The new Pleim-Xiu LSM is not yet ported to MPP MM5.


==========================================================


Please see Diff/diff.25JAN00 file for actual differences.

1. Bug fixes and modifications: 

- There are a few compiler flag changes for SGI, IBM SP2, IBM 
  Silver or Winterhawk nodes, and Fujitsu VPP.

  Affected file:
  configure.user

- Correct a logic to call nest initialization routine. Only affect complex
  nest configuration such as with two nests at the same nest level 
  (LEVIDN = 0,1,1,.., for example).

  Affected file:
  domain/driver/nstlev1.F, nstlev2.F, nstlev3.F

- Remove extra variable in the argument list to call rdinit.

  Affected file:
  domain/initial/init.F
  domain/nest/initnest.F

- Correct a time in print out when a nest starts during a model simulation.

  Affected file:
  domain/io/outtap.F

- Correct loop index range to avoid potential problem.

  Affected file:
  domain/nest/feedbk.F

- Correct feedback from Kain-Fritsch and Fritsch-Chappell schemes
  if mixed-phase or graupel scheme is also chosen. Feedback of snow
  (or graupel) and ice were missing before. We expect that the feedback 
  from the cumulus scheme is small.

  Affected file:
  physics/cumulus/fc/cupara5.F
  physics/cumulus/kf/cupara6.F

- Correct an error in calculating water vapor tendency in Anthes-Kuo
  scheme (ICUPA=2). This error was introduced in V3 because the major
  3D arrays are no longer coupled with p* in solve routine. Also, 
  the option for doing linear or logarithmic interpolation for vertical
  moisture advection now affects the Anthes-Kuo scheme.

  Affected file:
  physics/cumulus/kuo/cupara2.F

- Two corrections for shallow convection scheme (ISHALLO=1). 

  - Use of shallow convection scheme would cause ice processes in
    several explicit moisture schemes to be turned off.

  Affected file:
  physics/cumulus/shallow/shallow.F

  - Prevent shallow clouds from getting too deep, which prevents
    blow-ups in some cases.

  Affected file:
  physics/cumulus/shallow/entrs.F

  Warning: even with these fixes, this scheme should still be considered
  under development, and a user should use it with great caution.

- Correction to CCM2 scheme. A couple of years ago, some changes 
  were put in this scheme to correct or prevent floating point error.
  Unfortunately this sometimes adversely affected the results for the
  downward longwave radiation at the surface. This could, in extreme 
  deep cloud cases, severely under-predict ground temperature.
  A similar change will apply to this routine in V2.

  Affected file:
  physics/radiation/ccm2/radclw.F

- Prevent a READ error when doing surface analysis nudging.

  Affected file:
  fdda/grid/in4dgd.F

- Add back logarithmic interpolation for vertical advection of temperature 
  and moisture. IVTADV=IVQADV=0 option was accidentally removed in V3.

  Affected file:
  physics/advection/simple/vadv.F


2. Changes and improvements:

- Compilation options are updated for several platforms, such as SGI, IBM
  for shared-memory machines, and IBM and PC-clusters for distributed-memory
  machines. Check the option you are using carefully and bring it up-to-date
  with this release.

  Affected file:
  configure.user
  configure.user.linux

- Sea ice is more properly represented in present in the initial condition file.

  Affected file:
  domain/initial/init.F
  domain/io/rdinit.F

- Nest initialization without the nest input file is improved in this release
  (i.e. IOVERW=0, 2 options). Several steps are taken to improve the representation
  of land-water masked fields, such as ground and soil temperatures. 
  One of the steps taken is to add sea surface temperature to the input in 
  LOWBDY_DOMAINx file. It is used to reset temperature over the water (including
  lakes). One may still find unrealistic values of ground temperature over land,
  but this should be changed quicked by the physics of the model. 

  However this current fix still does not improve nest initialization when LSM 
  option is used. To initialize any nest when LSM option is used, a user is 
  recommended to run NESTDOWN program with MMINPUT_DOMAINn, LOWBDY_DOMAINn, 
  and TERRAIN_DOMAIN(n+1) as input. NESTDOWN is modified to properly interpolate 
  land-water masked fields, such as soil temperature, moisture, etc..

  Nest initialization with input file (IOVERW=1) is also improved by making soil
  temperature initialization in a nest consistent with other nest initialization
  method. 

  Affected file:
  domain/initial/init.F
  domain/nest/initnest.F

- Season definition is moved from init.F to param.F (a clean-up). 

  Affected file:
  domain/initial/init.F, param.F

- Change print statement to allow longer integration time to be printed correctly:

  Affected file:
  domain/initial/param.F
  domain/nest/initnest.F

- Will not print an output statement if that domain is not active.

  Affected file:
  domain/io/output.F

- Check to see if nest landuse type matches with that in the coarse domain.

  Affected file:
  domain/io/rdter.F

- Add loop indices to declare private variables for OpenMP. Does not affect
  results.

  Affected file:
  domain/nest/feedbk.F

- Change division by DT to multiplication by RDT to improve performance.

  Affected file:
  domain/nest/stotndt.F

- Change the definition of longwave radiation term GLW when CCM2 scheme is
  used. Now this term is the same as all other longwave radiation schemes used
  in the model. This will avoid confusion in the output, and will also fix
  the problem with combination of CCM2 and LSM options.

  Affected file:
  dynamics/nonhydro/solve.F
  physics/pbl_sfc/util/slab.F

- Add linux to the list of machines that require a second input file for FDDA.

  Affected file:
  fdda/grid/in4dgd.F

- Modify saturation mixing ratio calculation in Grell scheme.

  Affected file:
  physics/cumulus/grell/cup.F

- Change print statement to print out the i, j location when NAN error occurs 
  with explicit moisture scheme.

  Affected file:
  physics/explicit/reisner1/exmoisr.F, lexmoisr.F
  physics/explicit/simple/exmoiss.F, lexmoiss.F

- Make sub-time-step for 5-layer soil model (ISOIL=1 option) more conservative.

  Affected file:
  physics/pbl_sfc/util/slab.F


3. New feature:

- A new and more accurate longwave radiation scheme is available in this
  release - it may be referred to as RRTM which stands for Rapid Radiative
  Transfer Model (Mlawer et al. 1997). It uses the same shortwave radiation 
  scheme as in the cloud radiation option (FRAD=2). This new option is listed 
  as FRAD=4. It is roughly 5% more expensive to run.

  Affected file:
  configure.user
  configure.user.linux
  Util/parseconfig.c
  domain/initial/init.F, param.F
  domain/io/outtap.F
  domain/nest/initnest.F
  dynamics/nonhydro/solve.F
  physics/cumulus/grell/cup.F
  physics/radiation/Makefile
  physics/radiation/ccm2/Makefile
  physics/radiation/util/Makefile
  (The last two file changes reflect a move of two subroutines, inirad.F and
   o3data.F, from physics/radiation/ccm2 directory to physics/radiation/util,
   because RRTM option also uses them.)

- Add a paragraph in README file to explain how to set up one-way run if 
  using NESTDOWN to generate input files.


4. MPP changes:

- File read handling in MPP MM5 - prevent hanging situation if the file is not
  present. This change has been in the tar file since the end of September.

- Change soil T initialization check for MPP MM5. This change has been in 
  the tar file since the end of September.

For more information on MPP update, please read README.MPP.

==========================================================

Updated 9/27/99

- Add parallel directives to a do loop in solve.F.

- Enable MPP MM5 to detect input soil temperature at various soil levels
  in init.F

- Prevent MPP MM5 from hanging if any input files is not present.

- Remove an extra argument variable from the call to rdinit in init.F
  and initnest.F.

- Remove a line number when cpp "if defined" is used in in4dgd.F.

- Set substrate temperature for sea ice grids to be 271.16 K.



Please see Diff/diff.24SEP99 file for actual differences.

1. Bug fixes and modifications: 

- Major correction: invert map scale factor when using IOVERW=2
  option. This will affect all nest runs using IOVERW=2 option.
  (This change is in 3-1 tar file since 9/17/99.)

  Affected file:
  domain/nest/initnest.F

- Allow surface analysis nudging for nest when using IBLTYP=6 option.
  (This change is in 3-1 tar file since 9/17/99.)

  Affected file:
  domain/nest/initnest.F

- Add namelist IFOGSW to common block param2. This switch is not currently 
  used, but this avoids a compiler warning.
  (This change is in 3-1 tar file since 9/3/99.)

  Affected file:
  include/param2.incl

- Gayno-Seaman scheme is corrected for a bug that may lead to excessive
  cooling in cloudy layers.
  (This change is in 3-1 tar file since 8/24/99.)

  Affected file:
  physics/pbl_sfc/gspbl/gspbl.F

  Also corrected is the diffusion coefficient calculation which is done now
  prior to the call to GSPBL.

  A correction to the call to SFCRAD subroutine from GSPBL is placed.

- Allows Gayno-Seaman scheme to be used with FDDA.

  Affected file:
  domain/nest/initnest.F

- An error is corrected in snow-effect factor SCFX for USGS landuse category 23:
  Bare Ground Tundra (wintertime value).

  Affected file:
  Run/LANDUSE.TBL

- A number of Makefiles in subdirectories are updated to ensure correct make
  dependency. This may affect recompilation without first doing a 'make clean'.

  Affected file:
  domain/initial/Makefile
  domain/io/Makefile
  physics/pbl_sfc/osusfc/Makefile

- Correctly initialize a local array: CLDFRA3D for using radiatino option 3.

  Affected file:
  dynamics/nonhydro/solve.F

- Correct an array name in subroutine call to CUPARA4.

  Affected file:
  dynamics/nonhydro/solve.F

- Correction for using gridded FDDA option on SGI Origin series: it requires
  a copied file with different file name for FDDA.

  Affected files:
  Templates/mm5.deck.sgi 
  fdda/grid/in4dgd.F


2. Changes and improvements:

- Compilation options are updated for several platforms, such as SGI, IBM
  for shared-memory machines, and IBM and PC-clusters for distributed-memory
  machines. Check the option you are using carefully and bring it up-to-date
  with this release.

  Affected file:
  configure.user
  configure.user.linux

- The model is modified to be flexible in reading input soil temperature and
  moisture data. This is done through namelist variables ISTLYR and ISMLYR
  (currently hidden). It was fixed to read only 3-level soil temperature and 
  2-level soil moisture. Now it can also read model soil-level data in a one-way
  run using coarse mesh values for ISOIL=1 and 2 options. To facilitate one-way
  run using LSM option, a number of 2D fields are added to the output if ISOIL=2
  is selected in the coarse domain run.

  Checks are put in to make sure all needed fields for LSM are in the input.

  The number of seasons in the model, ISN, is added to include file: landuse.incl.

  Also a capability to pass SST from input to output of the model is added. The
  field name in the model for SST is TSS. Expect model output size to increase
  a little because of this addition.

  All OSU LSM code is now implicit none.

  Affected files:
  domain/initial/param.F
  domain/io/rdinit.F, rdter.F
  domain/nest/initnest.F
  include/landinp.incl, landuse.incl, parame, point2d.incl, point2dn.incl
  physics/pbl_sfc/osusfc/canres.F, dcoef.F, devap.F, hrt.F, hrtice.F, hstep.F,
  physics/pbl_sfc/osusfc/nopac.F, penman.F, osusfc/sflx.F, smflx.F, snopac.F, 
  physics/pbl_sfc/osusfc/srt.F, sstep.F, surfce.F

- The snow cover used for LSM and determined from water-equivalent depth of snow
  (field name WEASD) is set to 1 if WEASD > 1 mm instead of 0.1 mm. This will
  affect albedo as LSM snow cover varies.

  Affected file:
  domain/io/rdinit.F
  physics/pbl_pbl/osusfc/surfce.F

- Changed a print format.

  Affected file:
  domain/io/conmas.F

- Update description in big and sub headers in the output. Also, an error in
  determining file output name when TAPFRQ=BUFFRQ is corrected.

  Affected file:
  domain/io/outtap.F

- Changed Do loop indices in two routines to avoid unneccessary calculation.

  Affected files:
  physics/advection/simple/vadv.F
  physics/advection/simple/hadv.F

- Altered an If test to avoid possible division by zero in Kain-Fritsch scheme.

  Affected file:
  physics/cumulus/kf/kfpara.F

- Code change to prevent possible floating operation in Eta PBL scheme.

  Affected file:
  physics/myepbl/mixlen.F

- Model expected surface gridded FDDA file name has been changed to 
  SFCFDDA_DOMAINn to be consistent with Rawins output.

  Affected file:
  fdda/grid/in4dgd.F

- The look-up table version of Reisner I (mixed phase) scheme is now
  working in V3.

  Affected file:
  physics/explicit/reisner1/lexmoisr.F


3. MPP changes:

  (If you are an MPP MM5 user, please obtain an updated MPP tar file.)

- Continuing development of on-line help for MPP option.
  http://www.mmm.ucar.edu/mm5/mpp and http://www.mmm.ucar.edu/mm5/mpp/helpdesk.
  Lots of new information here about Linux too.

- Streamlined compilation for Linux PC cluster machines, tested on ANL Linux
  PC cluster (collage).  See Section 7g of configure.user for additional
  information.

- Incorporated a number of fixes in the model and in the RSL library to
  handle communication of character data between processors, required for
  implementing the Version 3 I/O file format on the T3E.

- The 'make mm5.deck' now creates a mm5.deck script for all platforms listed
  in Section 7. The mm5.deck scripts for the MPP platforms only create namelist
  (mmlif) files; they do not run the model (a difference with the non-MPP
  scripts). See README.MPP.

- Verified that restarts work with MPP option in V3.  See README.MPP for more
  information.

- Continuing migration of code to full use of IMPLICIT NONE

- Corrected problem with NaN's being generated on IBM SP with full
  optimization. Fix involved compiling the explicit moisture routines with -O3
  -qstrict, instead of just -O3

- Corrected problem with IBM's non-OpenMP compliant threadlocal directives in
  OSU LSM and BT PBL on IBM SP with SMP nodes.  Still non-compliant but now they
  work.

- Numerous bug fixes (strongly recommend updated to v3.2 asap)

